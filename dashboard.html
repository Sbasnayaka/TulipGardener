<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Tulip Gardener</title>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body class="welcome-bg-body">
    <!-- Falling Petals Background (from Menu) -->
    <div class="petals-container"></div>

    <!-- Top Navigation  -->
    <header class="welcome-top-nav">
        <div class="nav-brand">
            <div class="brand-hexagon">
                <img src="assets/logo.png" alt="Tulip Logo" style="width: 24px; height: 24px; object-fit: contain;">
            </div>
            <span>Tulip Gardener</span>
        </div>

        <div class="nav-center-pill">
            <a href="menu.html" class="nav-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Menu
            </a>
            <a href="dashboard.html" class="nav-item active">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="9" y1="3" x2="9" y2="21"></line>
                </svg>
                Dashboard
            </a>
            <a href="profile.html" class="nav-item">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                Profile
            </a>
        </div>

        <div class="nav-actions">
            <!-- Nav Actions Empty / Kept for spacing structure if needed, or mirrored from global layout -->
            <button class="icon-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                    </path>
                </svg>
            </button>
            <button class="icon-btn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="dashboard-main-layout">
        <div class="dashboard-glass-card">

            <!-- Column 1: Video & Actions -->
            <div class="dash-col dash-col-left">
                <div class="oval-video-mask">
                    <video autoplay loop muted playsinline>
                        <source src="assets/background%20v02.MP4" type="video/mp4">
                    </video>
                </div>
                <!-- Binding to menu.html safely -->
                <a href="menu.html" class="welcome-go-btn grow-btn">Grow a new Tulip</a>
            </div>

            <!-- Divider Line -->
            <div class="dash-divider"></div>

            <!-- Column 2: Status -->
            <div class="dash-col dash-col-center">
                <h3 class="dash-status-title">Gardener Status</h3>

                <div class="dash-status-item">
                    <p>Current level</p>
                    <div class="status-circle-hollow" id="level-badge">
                        Beginner
                    </div>
                </div>

                <div class="dash-status-item">
                    <p>Total tulips</p>
                    <div class="status-circle-hollow score-circle" id="score-badge">
                        0
                    </div>
                </div>
            </div>

            <!-- Column 3: Garden Grid -->
            <div class="dash-col dash-col-right">
                <div class="garden-viewport">
                    <div class="garden-grid-scrollable" id="garden">
                        <!-- Dynamic content filled by JS -->
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- Architecture -->
    <script src="js/services/supabaseClient.js"></script>
    <script src="js/services/UserService.js"></script>
    <script src="js/controllers/AuthController.js"></script>

    <!-- Background Petal Rain (Shared logic from menu.html) -->
    <script>
        function createShinyPetals() {
            const container = document.querySelector('.petals-container');
            if (!container) return;
            const petalCount = 120; // Generating over 100 petals

            for (let i = 0; i < petalCount; i++) {
                const petal = document.createElement('div');
                petal.classList.add('shiny-petal');

                const leftPos = Math.random() * 100;
                const animDuration = Math.random() * 12 + 8;
                const animDelay = Math.random() * 10;
                const scale = Math.random() * 0.2 + 0.1;

                petal.style.left = `${leftPos}vw`;
                petal.style.animationDuration = `${animDuration}s`;
                petal.style.animationDelay = `-${animDelay}s`;
                petal.style.setProperty('--scale-factor', scale);

                const initialRotation = Math.random() * 360;
                petal.style.setProperty('--rot-start', `${initialRotation}deg`);
                petal.style.setProperty('--rot-end', `${initialRotation + (Math.random() > 0.5 ? 360 : -360)}deg`);

                container.appendChild(petal);
            }
        }
        createShinyPetals();

        // Core Dashboard Logic Intact
        async function loadDashboard() {
            const authed = await AuthController.requireAuth();
            if (!authed) return;

            try {
                const profile = await UserService.getProfile();
                document.getElementById('score-badge').innerText = profile.score;

                // Determine level
                let level = 'Beginner';
                if (profile.score >= 6) level = 'Pro';
                else if (profile.score >= 3) level = 'Intermediate';
                document.getElementById('level-badge').innerText = level;

                // Render garden
                renderGarden(profile.score);
            } catch (e) {
                console.error('Dashboard load error:', e);
            }
        }

        // Updated Render Garden overriding simple emojis to use the PNG inside wireframe circles
        function renderGarden(score) {
            const grid = document.getElementById('garden');
            grid.innerHTML = '';

            // Generate minimum 9 slots to respect grid structure, but allow infinite scrolling
            const totalSlots = Math.max(9, score);

            for (let i = 0; i < totalSlots; i++) {
                const slot = document.createElement('div');
                slot.className = 'garden-wire-slot';

                if (i < score) {
                    const img = document.createElement('img');
                    img.src = 'assets/tulip flower.png';
                    img.alt = 'Grown Tulip';
                    img.className = 'grown-tulip-img';
                    slot.appendChild(img);
                }
                grid.appendChild(slot);
            }
        }

        loadDashboard();
    </script>
    <!-- Global Floating Action Buttons -->
    <div class="global-fab-container">
        <a href="menu.html" class="fab-btn fab-play" title="Play Game">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        </a>
        <a href="dashboard.html" class="fab-btn fab-leaderboard" title="Leaderboard">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20v-6"></path>
                <path d="M6 20V10"></path>
                <path d="M18 20V4"></path>
            </svg>
        </a>
    </div>
</body>

</html>